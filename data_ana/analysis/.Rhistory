knitr::opts_chunk$set(echo = TRUE)
library(here)
library(tidyverse)
library(langcog)
d <- read_csv(here("processed_data/et_cleaned.csv"))
head(d)
source(here("processing_scripts/et_helper.R")) # calling R scripts that contain code for useful functions
source(here("processing_scripts/useful.R"))
d <- d %>%
mutate(group = case_when(
grepl("H", subid) ~ "novice",
grepl("G", subid) ~ "expert"
)) %>%
mutate_if(is.character, as.factor)
# poem
rois <- list()
rois[[1]] <- c(517, 1050-542-223,304,223)
rois[[2]] <- c(522, 1050-760-152, 280, 152)
rois[[3]] <- c(515, 1050-352-222, 300, 222)
rois[[4]] <- c(517, 1050-229-153, 289, 153)
rois[[5]] <- c(515, 1050-95-127, 291, 127)
rois[[6]] <- c(515, 1050-28-60, 292, 60)
names(rois) <- c("AOI_st9-11","AOI_st12-13", "AOI_st6-8", "AOI_st3-5", "AOI_st1-2", "AOI_Title")
roi.image(rois)
d1 <- d %>%
filter(stimulus == "poem_first" | stimulus == "poem_second")
d1$roi <- roi.check(d1,rois)
# lyrics 1
rois <- list()
rois[[1]] <- c(518, 1050-362-151,424,151)
rois[[2]] <- c(516, 1050-528-170, 444,170)
rois[[3]] <- c(525, 1050-700-235, 445, 235)
rois[[4]] <- c(511, 1050-186-172, 431, 172)
rois[[5]] <- c(516, 1050-90-84, 424, 84)
rois[[6]] <- c(523, 1050-43-35, 188, 35)
names(rois) <- c("AOI_st3","AOI_st4", "AOI_st5", "AOI_st2", "AOI_st1", "AOI_lyricsTitle")
roi.image(rois)
d2 <- d %>%
filter(stimulus == "lyrics_first_p1" | stimulus == "lyrics_second_p1")
d2$roi <- roi.check(d2,rois)
# lyrics 2
rois <- list()
rois[[1]] <- c(508, 1050-296-116, 460, 116)
rois[[2]] <- c(511, 1050-100-193, 452, 193)
rois[[3]] <- c(526, 1050-31-50, 200, 50)
names(rois) <- c("AOI_st7", "AOI_st6", "AOI_lyricsTitle2")
roi.image(rois)
d3 <- d %>%
filter(stimulus == "lyrics_first_p2" | stimulus == "lyrics_second_p2")
d3$roi <- roi.check(d3,rois)
d0 <- rbind(d1, d2, d3)
d <- d0 %>%
droplevels()
d <- d %>%
mutate(roi_cat = case_when(
grepl("Title", roi) ~ "title",
roi == "AOI_st1" ~ "st_first",
roi == "AOI_st1-2" ~ "st_first",
roi == "AOI_st12-13" ~ "st_last",
roi == "AOI_st7" ~ "st_last",
TRUE ~ "other"
)) %>%
mutate(stim_cat = case_when(
grepl("lyrics", stimulus) ~ "lyrics",
grepl("poem", stimulus) ~ "poem"
))
d2 <- d %>%
group_by(stimulus, stim_cat, roi_cat, group, subid) %>%
summarise(n = n())
d3 <- d %>%
group_by(stimulus, stim_cat, group, subid) %>%
summarise(ntotal = n())
d_comp1 <- left_join(d2, d3) %>%
mutate(prop = n/ntotal) %>%
group_by(stim_cat, roi_cat, group) %>%
multi_boot_standard(col="prop") %>%
mutate(prop = mean) %>%
select(-mean)
ggplot(data=filter(d_comp1, stim_cat == "poem", roi_cat != "other"),
aes(x=roi_cat, y=prop, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion looking") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("poem")
ggplot(data=filter(d_comp1, stim_cat == "lyrics", roi_cat != "other"),
aes(x=roi_cat, y=prop, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion looking") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("lyrics")
d_comp2 <- left_join(d2, d3) %>%
mutate(prop = n/ntotal) %>%
group_by(stimulus, roi_cat, group) %>%
multi_boot_standard(col="prop") %>%
mutate(prop = mean) %>%
select(-mean)
ggplot(data=filter(d_comp2, stimulus == "poem_first", roi_cat != "other"),
aes(x=roi_cat, y=prop, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion looking") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("poem first read")
ggplot(data=filter(d_comp2, stimulus == "poem_second", roi_cat != "other"),
aes(x=roi_cat, y=prop, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion looking") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("poem second read")
ggplot(data=filter(d_comp2, stimulus == "lyrics_first_p1", roi_cat != "other"),
aes(x=roi_cat, y=prop, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion looking") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("lyrics first read p1")
ggplot(data=filter(d_comp2, stimulus == "lyrics_first_p2", roi_cat != "other"),
aes(x=roi_cat, y=prop, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion looking") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("lyrics first read p2")
ggplot(data=filter(d_comp2, stimulus == "lyrics_second_p1", roi_cat != "other"),
aes(x=roi_cat, y=prop, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion looking") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("lyrics second read p1")
ggplot(data=filter(d_comp2, stimulus == "lyrics_second_p2", roi_cat != "other"),
aes(x=roi_cat, y=prop, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion looking") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("lyrics second read p2")
head(d_comp2)
head(d2)
head(d)
levels(d$roi)
levels(d$roi_cat)
levels(factor(d$roi_cat))
d_shift <- d %>%
mutate(roi_before = shift(roi_cat))
?shift
library(data.table)
d_shift <- d %>%
mutate(roi_before = shift(roi_cat))
head(d_shift)
head(d_shift)
?cases_when
?case_when
head(d_shift)
head(d_shift)
levels(roi_cat)
levels(d$roi_cat)
levels(d_shift$roi_cat)
levels(factor(d_shift$roi_cat))
d_shift <- d %>%
mutate(roi_before = shift(roi_cat)) %>%
mutate(roi_shift_spec = case_when(
roi_cat == "title" | roi_cat != roi_before ~ "switch_to_title",
roi_cat == "st_first" | roi_cat != roi_before ~ "switch_to_firstStanza",
roi_cat == "st_last" | roi_cat != roi_before ~ "switch_to_lastStanza"
)) %>%
mutate(roi_shift = case_when(
roi_cat != roi_before ~ "switch_to_title"
))
head(d_shift)
d_shift <- d %>%
mutate(roi_before = shift(roi_cat)) %>%
mutate(roi_shift_spec = case_when(
roi_cat == "title" | roi_cat != roi_before ~ "switch_to_title",
roi_cat == "st_first" | roi_cat != roi_before ~ "switch_to_firstStanza",
roi_cat == "st_last" | roi_cat != roi_before ~ "switch_to_lastStanza",
TRUE ~ "no_switch"
)) %>%
mutate(roi_shift = case_when(
roi_cat != roi_before ~ "switch_to_title",
TRUE ~ "no_switch"
))
head(d_shift)
head(d_shift)
head(d_shift)
d_shift %>%
group_by(group, roi_shift, subid)
summarise(n_shift = nrow())
summarise(n_shift = count())
?n
d_shift %>%
group_by(group, roi_shift, subid)
d_shift %>%
group_by(group, roi_shift, subid) %>%
summarise(n_shift = n())
d_shift %>%
group_by(group, subid, roi_shift, subid) %>%
summarise(n_shift = n()) %>%
spread(roi_shift)
?spread
d_shift %>%
group_by(group, subid, roi_shift, subid) %>%
summarise(n_shift = n())
d_shift %>%
group_by(group, subid, roi_shift, subid) %>%
summarise(n_shift = n()) %>%
spread(roi_shift, n_shift)
d_shift <- d %>%
mutate(roi_before = shift(roi_cat)) %>%
mutate(roi_shift_spec = case_when(
roi_cat == "title" | roi_cat != roi_before ~ "switch_to_title",
roi_cat == "st_first" | roi_cat != roi_before ~ "switch_to_firstStanza",
roi_cat == "st_last" | roi_cat != roi_before ~ "switch_to_lastStanza",
TRUE ~ "no_switch"
)) %>%
mutate(roi_shift = case_when(
roi_cat != roi_before ~ "switch",
TRUE ~ "no_switch"
))
d_shift %>%
group_by(group, subid, roi_shift, subid) %>%
summarise(n_shift = n()) %>%
spread(roi_shift, n_shift) %>%
mutate()
d_shift %>%
group_by(group, subid, roi_shift, subid) %>%
summarise(n_shift = n()) %>%
spread(roi_shift, n_shift)
d_shift %>%
group_by(group, subid, roi_shift, subid) %>%
summarise(n_shift = n()) %>%
spread(roi_shift, n_shift) %>%
mutate(switch_prop = switch/(no_switch+switch))
d_shift %>%
group_by(group, subid, roi_shift, subid) %>%
summarise(n_shift = n()) %>%
spread(roi_shift, n_shift) %>%
mutate(switch_prop = switch/(no_switch+switch)) %>%
group_by(group) %>%
multi_boot_standard(col="switch_pop")
d_shift %>%
group_by(group, subid, roi_shift, subid) %>%
summarise(n_shift = n()) %>%
spread(roi_shift, n_shift) %>%
mutate(switch_prop = switch/(no_switch+switch)) %>%
group_by(group) %>%
multi_boot_standard(col="switch_prop")
d_shift %>%
group_by(group, subid, roi_shift, subid) %>%
summarise(n_shift = n()) %>%
spread(roi_shift, n_shift) %>%
mutate(switch_prop = switch/(no_switch+switch)) %>%
group_by(group) %>%
multi_boot_standard(col="switch_prop") %>%
ggplot(data=.,
aes(x=group, y=mean, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion switching") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("Switching")
d_shift %>%
group_by(group, subid, roi_shift_spec, subid) %>%
summarise(n_shift = n())
d_shift %>%
group_by(group, subid, roi_shift_spec, subid) %>%
summarise(n_shift = n()) %>%
spread(roi_shift_spec, n_shift)
d_shift_spec <- d_shift %>%
group_by(group, subid, roi_shift_spec, subid) %>%
summarise(n_shift = n()) %>%
spread(roi_shift_spec, n_shift) %>%
mutate(
switch_prop_title = switch_to_title/(no_switch+switch_to_title+switch_to_firstStanza+switch_to_lastStanza),
switch_prop_first = switch_to_firstStanza/(no_switch+switch_to_title+switch_to_firstStanza+switch_to_lastStanza),
switch_prop_last = switch_to_lastStanza/(no_switch+switch_to_title+switch_to_firstStanza+switch_to_lastStanza)
)
d_shift_spec
d_shift_spec %>%
group_by(group) %>%
multi_boot_standard(col="switch_prop_title") %>%
ggplot(data=.,
aes(x=group, y=mean, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion switching") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("Switching to title")
d_shift_spec %>%
group_by(group) %>%
multi_boot_standard(col="switch_prop_first") %>%
ggplot(data=.,
aes(x=group, y=mean, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion switching") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("Switching to first stanza")
d_shift_spec %>%
group_by(group) %>%
multi_boot_standard(col="switch_prop_title") %>%
ggplot(data=.,
aes(x=group, y=mean, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion switching") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("Switching to title")
d_shift_spec %>%
group_by(group) %>%
multi_boot_standard(col="switch_prop_first") %>%
ggplot(data=.,
aes(x=group, y=mean, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion switching") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("Switching to first stanza")
d_shift_spec %>%
group_by(group) %>%
multi_boot_standard(col="switch_prop_last") %>%
ggplot(data=.,
aes(x=group, y=mean, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion switching") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("Switching to last stanza")
head(d_shift)
head(d_shift)
library(lme4)
left_join(d2, d3)
left_join(d2, d3)
d_comp_ana <- left_join(d2, d3) %>%
mutate(prop = n/ntotal)
summary(lmer(prop ~ roi_cat * group + (stimulus | subid)))
d_comp_ana <- left_join(d2, d3) %>%
mutate(prop = n/ntotal)
summary(data=d_comp_ana, lmer(prop ~ roi_cat * group + (stimulus | subid)))
head(d_comp_ana)
summary(lmer(prop ~ roi_cat * group + (stimulus | subid), data=d_comp_ana))
head(d)
head(d)
d_shift <- d %>%
mutate(roi_before = shift(roi)) %>%
mutate(roi_shift_spec = case_when(
roi_cat == "title" | roi != roi_before ~ "switch_to_title",
roi_cat == "st_first" | roi != roi_before ~ "switch_to_firstStanza",
roi_cat == "st_last" | roi != roi_before ~ "switch_to_lastStanza",
TRUE ~ "no_switch"
)) %>%
mutate(roi_shift = case_when(
roi != roi_before ~ "switch",
TRUE ~ "no_switch"
))
d_shift %>%
group_by(group, subid, roi_shift, subid) %>%
summarise(n_shift = n()) %>%
spread(roi_shift, n_shift) %>%
mutate(switch_prop = switch/(no_switch+switch)) %>%
group_by(group) %>%
multi_boot_standard(col="switch_prop") %>%
ggplot(data=.,
aes(x=group, y=mean, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion switching") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("Switches (from one region to another)")
d_shift_spec <- d_shift %>%
group_by(group, subid, roi_shift_spec, subid) %>%
summarise(n_shift = n()) %>%
spread(roi_shift_spec, n_shift) %>%
mutate(
switch_prop_title = switch_to_title/(no_switch+switch_to_title+switch_to_firstStanza+switch_to_lastStanza),
switch_prop_first = switch_to_firstStanza/(no_switch+switch_to_title+switch_to_firstStanza+switch_to_lastStanza),
switch_prop_last = switch_to_lastStanza/(no_switch+switch_to_title+switch_to_firstStanza+switch_to_lastStanza)
)
d_shift_spec %>%
group_by(group) %>%
multi_boot_standard(col="switch_prop_title") %>%
ggplot(data=.,
aes(x=group, y=mean, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion switching") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("Switching to title")
d_shift_spec %>%
group_by(group) %>%
multi_boot_standard(col="switch_prop_first") %>%
ggplot(data=.,
aes(x=group, y=mean, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion switching") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("Switching to first stanza")
d_shift_spec %>%
group_by(group) %>%
multi_boot_standard(col="switch_prop_last") %>%
ggplot(data=.,
aes(x=group, y=mean, fill=group)) +
geom_bar(stat="identity", position="dodge") +
ylab("Proportion switching") +
geom_linerange(aes(ymin=ci_lower,ymax=ci_upper),
position = position_dodge(width = 0.9)) +
ggtitle("Switching to last stanza")
